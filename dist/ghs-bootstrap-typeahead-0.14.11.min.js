/*
 * ghs-typeahead
 * http://angular-ui.github.io/bootstrap/

 * Version: 0.14.11 - 2015-10-28
 * License: MIT
 */
angular.module("ghs.bootstrap",["ghs.bootstrap.typeahead"]),angular.module("ghs.bootstrap.typeahead",["ui.bootstrap.position"]).factory("ghsTypeaheadParser",["$parse",function(a){var b=/^\s*([\s\S]+?)(?:\s+as\s+([\s\S]+?))?\s+for\s+(?:([\$\w][\$\w\d]*))\s+in\s+([\s\S]+?)$/;return{parse:function(c){var d=c.match(b);if(!d)throw new Error('Expected typeahead specification in form of "_modelValue_ (as _label_)? for _item_ in _collection_" but got "'+c+'".');return{itemName:d[3],source:a(d[4]),viewMapper:a(d[2]||d[1]),modelMapper:a(d[1])}}}}]).directive("ghsTypeahead",["$compile","$parse","$q","$timeout","$document","$uibPosition","ghsTypeaheadParser",function(a,b,c,d,e,f,g){var h=[9,13,27,38,40];return{require:"ngModel",link:function(f,g,i,j){function k(a){for(var b=0,c=a.target;c&&4>=b;c=c.parentNode){if(c===g[0]||c===g[0].nextSibling)return!0;b++}return!1}var l=(f.$eval(i.typeaheadMinLength)||1,f.$eval(i.typeaheadWaitMs)||0),m=f.$eval(i.typeaheadEditable)!==!1,n=b(i.typeaheadLoading).assign||angular.noop,o=f.$eval(i.typeaheadParentTemplate)||"",p=b(i.typeaheadOnSelect),q=i.typeaheadInputFormatter?b(i.typeaheadInputFormatter):void 0,r=i.typeaheadAppendToBody?f.$eval(i.typeaheadAppendToBody):!1,s=b(i.ngModel).assign,t=typeaheadParser.parse(i.typeahead),u=!0,v=!0,w=i.exposeReload?f.$eval(i.exposeReload):!1,x=f.$new();f.$on("$destroy",function(){x.$destroy()}),x.popupState={visible:!1},x.matches=[];var y="typeahead-"+x.$id+"-"+Math.floor(1e4*Math.random());g.attr({"aria-autocomplete":"list","aria-expanded":!1,"aria-owns":y});var z=function(){u&&!x.popupState.visible&&(x.popupState.visible=!0,D(j.$viewValue),x.$digest())};g.on("click",function(){z()}),g.on("focus",function(){z()});var A=angular.element("<div typeahead-popup></div>");A.attr({id:y,matches:"matches",active:"activeIdx",select:"select(activeIdx)",query:"query",position:"position","popup-state":"popupState",parentTemplate:o}),angular.isDefined(i.typeaheadTemplateUrl)&&A.attr("template-url",i.typeaheadTemplateUrl);var B=function(){x.activeIdx=-1,x.popupState.visible=!1,g.attr("aria-expanded",!1)},C=function(a){return y+"-option-"+a};x.$watch("activeIdx",function(a){0>a?g.removeAttr("aria-activedescendant"):g.attr("aria-activedescendant",C(a))});var D=function(a){var b={$viewValue:a};n(f,!0),c.when(t.source(f,b)).then(function(c){var d=a===j.$viewValue;if(d&&x.popupState.visible)if(L(),c.length>0||Object.keys(c).length>0){x.activeIdx=-1,x.matches.length=0;for(var e=0;e<c.length;e++)b[t.itemName]=c[e],x.matches.push({id:C(e),label:t.viewMapper(x,b),model:c[e]});x.query=a,x.position=r?$position.offset(g):$position.position(g),x.position.top=x.position.top+g.prop("offsetHeight"),g.attr("aria-expanded",!0)}else x.matches.length=0,B();d&&n(f,!1)},function(){B(),n(f,!1)})};w&&(f.ngTypeaheadReload=D),B(),x.query=void 0;var E,F,G,H=function(a){E=d(function(){D(a)},l)},I=function(){E&&d.cancel(E)},J=function(){K(),u=!1,F=d(function(){u=!0,x.$digest()},250)},K=function(){F&&d.cancel(F)},L=function(){M(),v=!1,G=d(function(){v=!0,x.$digest()},250)},M=function(){G&&d.cancel(G)};j.$parsers.unshift(function(a){return x.popupState.visible=!0,l>0?(I(),H(a)):D(a),m?a:a?void j.$setValidity("editable",!1):(j.$setValidity("editable",!0),a)}),j.$formatters.push(function(a){var b,c,d={};return q?(d.$model=a,q(f,d)):(d[t.itemName]=a,b=t.viewMapper(f,d),d[t.itemName]=void 0,c=t.viewMapper(f,d),b!==c?b:a)}),x.select=function(a){var b,c,e={};v&&a>=0&&x.matches.length&&(e[t.itemName]=c=x.matches[a].model,c.ngDisabled||(b=t.modelMapper(f,e),s(f,b),j.$setValidity("editable",!0),p(f,{$item:c,$model:b,$label:t.viewMapper(f,e)}),J(),B(),d(function(){g[0].focus()},0,!1)))},g.bind("keydown",function(a){x.popupState.visible&&-1!==h.indexOf(a.which)&&(40===a.which?(a.preventDefault(),x.activeIdx=(x.activeIdx+1)%x.matches.length,x.$digest()):38===a.which?(a.preventDefault(),-1===x.activeIdx&&(x.activeIdx=0),x.activeIdx=(x.activeIdx?x.activeIdx:x.matches.length)-1,x.$digest()):13===a.which||9===a.which?-1!==x.activeIdx?(a.preventDefault(),x.$apply(function(){x.select(x.activeIdx)})):(B(),x.$digest()):27===a.which&&(a.preventDefault(),a.stopPropagation(),B(),x.$digest()))});var N=function(a){v&&!k(a)&&(B(),x.$digest())};e.bind("click",N),f.$on("$destroy",function(){e.unbind("click",N)});var O=a(A)(x);r?e.find("body").append(O):g.after(O)}}}]).directive("ghsTypeaheadPopup",function(){return{restrict:"EA",scope:{matches:"=",query:"=",active:"=",position:"=",select:"&",popupState:"="},replace:!0,templateUrl:function(a,b){var c=""!==b.parenttemplate?b.parenttemplate:"typeahead-popup";return"template/typeahead/"+c+".html"},link:function(a,b,c){a.templateUrl=c.templateUrl,a.isOpen=function(){return a.popupState.visible&&a.matches.length>0},a.isActive=function(b){return a.active==b},a.selectActive=function(b){a.active=b},a.selectMatch=function(b){a.select({activeIdx:b})}}}}).directive("ghsTypeaheadMatch",["$http","$templateCache","$compile","$parse",function(a,b,c,d){return{restrict:"EA",scope:{index:"=",match:"=",query:"="},link:function(e,f,g){var h=d(g.templateUrl)(e.$parent)||"template/typeahead/typeahead-match.html";a.get(h,{cache:b}).success(function(a){f.replaceWith(c(a.trim())(e))})}}}]).filter("ghsTypeaheadHighlight",["$injector","$sce",function(a,b){function c(a){return a.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}function d(a){return/<.*>/g.test(a)}var e;return e=a.has("$sanitize"),function(a,f){return!e&&d(a)&&$log.warn("Unsafe use of typeahead please use ngSanitize"),a=f?(""+a).replace(new RegExp(c(f),"gi"),"<strong>$&</strong>"):a,e||(a=b.trustAsHtml(a)),a}}]);